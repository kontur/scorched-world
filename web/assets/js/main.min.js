function Player(){}function HumanPlayer(){Player.call(this)}var Force=function(a){this.direction=a};Force.prototype={},Player.prototype={position:null,mesh:null,direction:null,init:function(){var a=new THREE.IcosahedronGeometry(1,0),b=new THREE.MeshPhongMaterial({ambient:16711680,color:16724736,specular:39423,shininess:30,shading:THREE.FlatShading});this.mesh=new THREE.Mesh(a,b),this.obj=new THREE.Object3D;var c=new THREE.CylinderGeometry(.25,.5,4),d=new THREE.MeshPhongMaterial({ambient:16711680,color:65535,specular:39423,shininess:30,shading:THREE.FlatShading});this.canon=new THREE.Mesh(c,d),this.obj.add(this.mesh),this.obj.add(this.canon)},setPosition:function(a){console.log("Player.setPosition",a),this.position=a,this.obj.translateX(a.x),this.obj.translateY(a.y),this.obj.translateZ(a.z)},getMesh:function(){return this.obj},fire:function(){var a=new Projectile;return console.log("Player.fire()",this.position),a.direction=new THREE.Vector3(.5,.5,0),a.mass=.011,a.setPosition(this.position),a}},HumanPlayer.prototype=new Player,HumanPlayer.constructor=HumanPlayer;var Projectile=function(){var a=new THREE.SphereGeometry(.25,4,4),b=new THREE.MeshBasicMaterial({color:16711935}),c=new THREE.Mesh(a,b);this.id=Math.round(1e5*Math.random()),this.mass=.1,this.direction=new THREE.Vector3(0,0,0),this.position=new THREE.Vector3(0,0,0),this.drag=.01,this.obj=new THREE.Object3D,this.obj.add(c),this.obj.position=new THREE.Vector3(0,0,0),console.log("Projectile",this.obj.position)};Projectile.prototype={applyForce:function(a){this.direction=this.direction.add(a.direction.multiplyScalar(1+this.mass))},setPosition:function(a){this.position=a},update:function(){this.position=this.position.add(this.direction);var a=(new THREE.Vector3).subVectors(this.position,this.obj.position);this.obj.translateX(a.x),this.obj.translateY(a.y),this.obj.translateZ(a.z)}};var Scene=function(){function a(){$(window).on("mousewheel",function(a){a.originalEvent.wheelDelta>=0?e.position.z+=.25:e.position.z-=.25})}function b(){$(window).mousemove(function(a){var b=a.originalEvent.pageX,c=a.originalEvent.pageY,d=b/window.innerWidth,f=c/window.innerHeight;e.position.y=10+5*f,e.position.x=20*d-10,e.lookAt(new THREE.Vector3(0,0,0))})}function c(){if(requestAnimationFrame(c),g&&g.length){for(p in g)g[p].applyForce(gravity),g[p].update();l>200?g.pop():l++}f.render(d,e)}var d,e,f,g=[],h=function(){console.log("Scene.init()"),d=new THREE.Scene,e=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,150),f=new THREE.WebGLRenderer({canvas:document.getElementById("gamecanvas")}),f.setSize(window.innerWidth,window.innerHeight);var c=new THREE.DirectionalLight(16777215,.5);c.position.set(0,1,0),d.add(c),this.terrain=new Terrain,this.terrain.init(),d.add(this.terrain.mesh),d.add(this.terrain.wires),this.terrain.generatePlayerPositions(2,d),e.position.z=60,gravity=new Force(new THREE.Vector3(0,-.015,0)),b(),a()},i=function(){c()},j=function(a){d.add(a.getMesh())},k=function(a){g.push(a),d.add(a.obj),console.log("Scene.addProjectile",g.length)},l=0;return{init:h,start:i,addPlayer:j,terrain:function(){return terrain},addProjectile:k}}();Terrain=function(){var a,b,c=100,d=100,e=30,f=30,g=function(){a=new THREE.PlaneGeometry(c,d,e,f);for(var g=0;g<a.vertices.length;g++)a.vertices[g].z+=2*Math.random(),a.vertices[g].x+=Math.random()-.5,a.vertices[g].y+=Math.random()-.5;return a.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2)),a.verticesNeedUpdate=!0,b=new THREE.MeshDepthMaterial,this.mesh=new THREE.Mesh(a,b),this.wires=new THREE.Mesh(a,new THREE.MeshBasicMaterial({color:65382,wireframe:!0,wireframeLinewidth:2.5})),this},h=function(a){for(var b=[],c=0;a>c;c++)b.push(i());this.playerPositions=b},i=function(){return a.vertices[Math.floor(Math.random()*a.vertices.length)]};return{init:g,generatePlayerPositions:h}};var UI=function(){function a(){console.log("hello resize");var a=$(window).width(),b=$(window).height();$("#gamecanvas").css("width",a+"px"),$("#gamecanvas").css("height",b+"px")}var b=function(){$(window).on("resize",a),a(),console.log("hello ui init")};return{init:b}}();$(function(){var a;UI.init(),Scene.init(),Scene.start(),a=new HumanPlayer,a.init(),a.setPosition(Scene.terrain.playerPositions[0]),Scene.addPlayer(a),setTimeout(function(){Scene.addProjectile(a.fire())},1e3)});