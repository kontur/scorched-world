function Player(){this.position=null,this.mesh=null,this.direction=null,this.init=function(){var a=new THREE.IcosahedronGeometry(1,0),b=new THREE.MeshPhongMaterial({ambient:16711680,color:16724736,specular:39423,shininess:30,shading:THREE.FlatShading});this.mesh=new THREE.Mesh(a,b),this.obj=new THREE.Object3D;var c=2,d=new THREE.CylinderGeometry(.15,.5,c);d.applyMatrix((new THREE.Matrix4).makeTranslation(0,c/2,0));var e=new THREE.MeshPhongMaterial({ambient:16711680,color:65535,specular:39423,shininess:30,shading:THREE.FlatShading});this.canon=new THREE.Mesh(d,e),this.obj.add(this.mesh),this.obj.add(this.canon),this.canon.rotateX(45*Math.PI/180)},this.setPosition=function(a){console.log("Player.setPosition",a),this.position=a,this.obj.translateX(a.x),this.obj.translateY(a.y),this.obj.translateZ(a.z)},this.getMesh=function(){return this.obj},this.fire=function(){var a=new Projectile;a.direction=new THREE.Vector3(.5,.5,0),a.mass=.011,a.setPosition(this.position.clone()),$(this).trigger("PROJECTILE_FIRED",a)},this.addAngle=function(a){console.log("Player.setAngle",a,this.canon.rotation.x),this.canon.rotation.x+a>0&&this.canon.rotation.x+a<Math.PI/2&&this.canon.rotateX(a)},this.addRotation=function(a){console.log("Player.setRotation",this.obj,this.obj.rotation,this.obj.quaternion),this.obj.rotateOnAxis(new THREE.Vector3(0,1,0),a)}}function HumanPlayer(){function a(){console.log("HumanPlayer.setupControls()"),$(window).on("keydown",b)}function b(a){if(!c.controlsEnabled)return!1;console.log(a.keyCode);var b=2;switch(a.keyCode){case 38:c.addAngle(b*(Math.PI/180));break;case 40:c.addAngle(-b*(Math.PI/180));break;case 37:c.addRotation(-b*(Math.PI/180));break;case 39:c.addRotation(b*(Math.PI/180));break;case 32:c.fire()}}var c=this;this.controlsEnabled=!1,this.enableControls=function(){this.controlsEnabled=!0},this.disableControls=function(){this.controlsEnabled=!1},Player.call(this),a()}var Force=function(a){this.direction=a};Force.prototype={},HumanPlayer.prototype=new Player,HumanPlayer.constructor=HumanPlayer;var Projectile=function(){var a=new THREE.SphereGeometry(.25,4,4),b=new THREE.MeshBasicMaterial({color:16711935}),c=new THREE.Mesh(a,b);this.mass=.1,this.direction=new THREE.Vector3(0,0,0),this.position=new THREE.Vector3(0,0,0),this.drag=.01,this.obj=new THREE.Object3D,this.obj.add(c),this.obj.position=new THREE.Vector3(0,0,0),console.log("Projectile",this.obj.position)};Projectile.prototype={applyForce:function(a){this.direction=this.direction.add(a.direction.clone().multiplyScalar(1+this.mass))},setPosition:function(a){this.position=a},update:function(){this.position=this.position.add(this.direction);var a=(new THREE.Vector3).subVectors(this.position,this.obj.position);this.obj.translateX(a.x),this.obj.translateY(a.y),this.obj.translateZ(a.z)}};var Scene=function(){function a(){if(requestAnimationFrame(a),f&&f.length)for(p in f)f[p].applyForce(gravity),f[p].update(),f[p].position.y<-10&&(b.remove(f[p].obj),f=[]);d.render(b,c)}var b,c,d,e,f=[],g=function(){console.log("Scene.init()"),b=new THREE.Scene,c=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,150),d=new THREE.WebGLRenderer({canvas:document.getElementById("gamecanvas")}),d.setSize(window.innerWidth,window.innerHeight);var a=new THREE.DirectionalLight(16777215,.5);a.position.set(0,1,0),b.add(a),this.terrain=new Terrain,this.terrain.init(),b.add(this.terrain.mesh),b.add(this.terrain.wires),this.terrain.generatePlayerPositions(2,b),c.position.z=60,c.position.y=15,gravity=new Force(new THREE.Vector3(0,-.015,0))},h=function(){a()},i=function(a){b.add(a.getMesh()),c.lookAt(a.position),$(a).on("PROJECTILE_FIRED",function(a,b){console.log("addPlayer, onPROJECTILE_FIRED",a,b),j(b)}),e=a},j=function(a){console.log("Scene.addProjectile()",a),f.push(a),b.add(a.obj),console.log("Scene.addProjectile",f.length)};return{init:g,start:h,addPlayer:i,terrain:function(){return terrain},addProjectile:j}}();Terrain=function(){var a,b,c=100,d=100,e=30,f=30,g=function(){a=new THREE.PlaneGeometry(c,d,e,f);for(var g=0;g<a.vertices.length;g++)a.vertices[g].z+=2*Math.random(),a.vertices[g].x+=Math.random()-.5,a.vertices[g].y+=Math.random()-.5;return a.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2)),a.verticesNeedUpdate=!0,b=new THREE.MeshDepthMaterial,this.mesh=new THREE.Mesh(a,b),this.wires=new THREE.Mesh(a,new THREE.MeshBasicMaterial({color:3355443,wireframe:!0,wireframeLinewidth:2.5})),this},h=function(a){for(var b=[],c=0;a>c;c++)b.push(i());this.playerPositions=b},i=function(){return a.vertices[Math.floor(Math.random()*a.vertices.length)]};return{init:g,generatePlayerPositions:h}};var UI=function(){function a(){console.log("hello resize");var a=$(window).width(),b=$(window).height();$("#gamecanvas").css("width",a+"px"),$("#gamecanvas").css("height",b+"px")}var b=function(){$(window).on("resize",a),a(),console.log("hello ui init")};return{init:b}}(),p;$(function(){var a;UI.init(),Scene.init(),Scene.start(),a=new HumanPlayer,a.enableControls(),a.init(),a.setPosition(Scene.terrain.playerPositions[0]),p=a,Scene.addPlayer(a)});